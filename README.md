# JR北海道 運行監視システム 仕様書

このツールは、JR北海道の特定駅・特定方向の運行情報を定期的にチェックし、遅延や運休が発生している場合のみ Discord に通知を送るシステムです。

## 1. 監視対象と実行時間帯

現在の設定では、通勤・通学時間帯に合わせて以下の駅と時間帯のみを監視しています。

| 駅名 | 対象方向 | 実行時間帯 (日本時間) |
| :--- | :--- | :--- |
| **発寒中央駅** | 小樽方面 | **17:30 〜 19:00** |
| **手稲駅** | 札幌・岩見沢方面 | **07:30 〜 09:00** |

- 上記の時間帯以外は、システムが起動してもチェックをスキップします。
- 実行時間は 10分おき です（例: 17:30, 17:40...）。

## 2. 通知の条件（ノイズ除去）

通知のノイズを減らすため、以下の厳格なルールで判定しています。

- **通知対象**: 時刻表上に **「△（遅延）」** または **「✖（運休・部分運休）」** のアイコンが表示されている場合のみ通知します。
- **除外対象**: ステータスが「─（平常通り、もしくは微弱な影響）」となっている列車は通知しません。

## 3. 実行スケジュールと手動実行

- **自動実行**: GitHub Actions により、5分おきの固定スケジュールで実行されます。
- **手動実行**: GitHub の「Actions」タブから「Run workflow」ボタンを押すことで、いつでも即時実行できます。
  - 手動実行しても、自動実行のスケジュールがずれることはありません。
  - 実行が重なった場合は、最新のジョブが優先され、古いジョブは自動的に整理（キャンセル）されます。

## 4. 稼働状況の確認方法

システムの動作状況は、GitHub のリポジトリ上で確認できます。

1. **「Actions」タブ** を開く。
2. 左側の **「Train Monitor」** を選択。
3. 履歴の緑色のチェックボタン（成功）をクリックし、中身の **`Run monitor script`** を展開すると、どの列車をどう判定したかの詳細ログが見れます。

## 5. 設定の変更について

監視時間帯や駅の変更は `train_monitor/main.py` 内の `STATIONS` 設定を書き換えることで調整可能です。
